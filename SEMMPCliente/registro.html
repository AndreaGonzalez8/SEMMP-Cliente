<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Registro</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/estilos.css">
  <style>
    .color {
      background: linear-gradient(to right, #003366, #4da6ff);
    }
  </style>
</head>

<body class="color d-flex align-items-center justify-content-center" style="min-height: 100vh;">
  <div class="card p-4 shadow" style="width: 100%; max-width: 500px; border-radius: 20px;">
    <div class="text-center mb-4">
      <img src="img/login-icon.png" alt="Icono" width="100">
      <h2 class="mt-2">Registro</h2>
    </div>

    <!-- Formulario de registro -->
    <form id="registroForm">
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre completo</label>
        <input type="text" class="form-control" id="nombre" name="nombre" required>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Correo electrónico</label>
        <input type="email" class="form-control" id="email" name="email" required>
      </div>

      <div class="mb-3">
        <label for="usuario" class="form-label">Nombre de usuario</label>
        <input type="text" class="form-control" id="usuario" name="usuario" required>
      </div>

      <div class="mb-3">
        <label for="celular" class="form-label">Número de celular</label>
        <input type="tel" class="form-control" id="celular" name="celular" pattern="[0-9]{10}" required>
      </div>

      <div class="mb-3">
        <label for="rol" class="form-label">Rol</label>
        <select class="form-select" id="rol" name="rol" required>
          <option value="" disabled selected>Selecciona un rol</option>
          <option value="cliente">Cliente</option>
          <option value="tecnico">Técnico</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="contrasena" class="form-label">Contraseña</label>
        <input type="password" class="form-control" id="contrasena" name="contrasena" required>
      </div>

      <div class="mb-3">
        <label for="confirmarContrasena" class="form-label">Confirmar contraseña</label>
        <input type="password" class="form-control" id="confirmarContrasena" required>
      </div>

      <div class="d-grid mb-3">
        <button type="submit" class="btn text-white" style="background: linear-gradient(to right, #003366, #4da6ff);">
          Crear cuenta
        </button>
      </div>

      <div class="text-center">
        <span>¿Ya tienes una cuenta?</span>
        <a href="login.html" class="text-primary fw-bold">Inicia sesión</a>
      </div>
    </form>
  </div>

  <script>
    document.querySelector("#registroForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      // Validar contraseñas
      const contrasena = document.querySelector("#contrasena").value;
      const confirmar = document.querySelector("#confirmarContrasena").value;
      if (contrasena !== confirmar) {
        alert("⚠️ Las contraseñas no coinciden");
        return;
      }

      // Capturar los datos del formulario
      const datos = {
        nombre: document.querySelector("#nombre").value,
        email: document.querySelector("#email").value,
        celular: document.querySelector("#celular").value,
        rol: document.querySelector("#rol").value,
        contrasena: document.querySelector("#contrasena").value
      };

      try {
        const response = await fetch("http://localhost:8080/SistemaWeb/RegistroServlet", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(datos)
        });

        // Esperar respuesta en JSON desde el servlet
        const result = await response.json();

        if (result.status === "ok") {
          alert("✅ " + result.message);
          // Redirige al login
          window.location.href = "login.html";
        } else {
          alert("⚠️ " + result.message);
        }
      } catch (error) {
        console.error("Error en el registro:", error);
        alert("❌ Error al registrar el usuario. Intenta más tarde.");
      }
    });
  </script>
</body>

</html>